import pytest
from ckb_textify.core.pipeline import Pipeline
from ckb_textify.core.types import NormalizationConfig

# Initialize a default pipeline for reuse across tests
@pytest.fixture(scope="module")
def pipe():
    return Pipeline()

# --- 1. Numbers & Math ---
@pytest.mark.parametrize("input_text, expected", [
    # Integers & Decimals
    ("123", "Ø³Û•Ø¯ Ùˆ Ø¨ÛŒØ³Øª Ùˆ Ø³Û"),
    ("12.5", "Ø¯ÙˆØ§Ø²Ø¯Û• Ùˆ Ù†ÛŒÙˆ"),
    ("0.005", "Ø³ÙØ± Ù¾Û†ÛŒÙ†Øª Ø³ÙØ± Ø³ÙØ± Ù¾ÛÙ†Ø¬"),
    ("-50", "Ø³Ø§Ù„Ø¨ Ù¾Û•Ù†Ø¬Ø§"),
    ("+20", "Ù…ÙˆØ¬Û•Ø¨ Ø¨ÛŒØ³Øª"),
    # Scientific Notation Thresholds
    ("0.00000000000000000000004", "Ú†ÙˆØ§Ø± Ø¬Ø§Ø±Ø§Ù†ÛŒ Ø¯Û• ØªÙˆØ§Ù†ÛŒ Ø³Ø§Ù„Ø¨ Ø¨ÛŒØ³Øª Ùˆ Ø³Û"),
    ("34000000000000000000000", "Ø³Û Ù¾Û†ÛŒÙ†Øª Ú†ÙˆØ§Ø± Ø¬Ø§Ø±Ø§Ù†ÛŒ Ø¯Û• ØªÙˆØ§Ù†ÛŒ Ø¨ÛŒØ³Øª Ùˆ Ø¯ÙˆÙˆ"),
    ("5.2e-10", "Ù¾ÛÙ†Ø¬ Ù¾Û†ÛŒÙ†Øª Ø¯ÙˆÙˆ Ø¬Ø§Ø±Ø§Ù†ÛŒ Ø¯Û• ØªÙˆØ§Ù†ÛŒ Ø³Ø§Ù„Ø¨ Ø¯Û•"),
    # Leading Zeros
    ("0025", "Ø³ÙØ± Ø³ÙØ± Ø¨ÛŒØ³Øª Ùˆ Ù¾ÛÙ†Ø¬"),
    ("000007", "Ù¾ÛÙ†Ø¬ Ø¬Ø§Ø± Ø³ÙØ± Ø­Û•ÙˆØª"),
    # Fractions & Mixed Numbers
    ("1/2", "Ù†ÛŒÙˆÛ•"),
    ("1/4", "Ú†Ø§Ø±Û•Ú©"),
    ("3/4", "Ø³Û Ø¯Ø§Ø¨Û•Ø´ Ú†ÙˆØ§Ø±"),
    ("1/3", "ÛŒÛ•Ú© Ø¯Ø§Ø¨Û•Ø´ Ø³Û"),
    ("1/8", "ÛŒÛ•Ú© Ø¯Ø§Ø¨Û•Ø´ Ú¾Û•Ø´Øª"), # Standard Heh
    ("12 3/8", "Ø¯ÙˆØ§Ø²Ø¯Û• Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•ÙˆØ§Ùˆ Ùˆ Ø³Û Ù„Û•Ø³Û•Ø± Ú¾Û•Ø´Øª"), # Standard Heh
    ("5Â½", "Ù¾ÛÙ†Ø¬ Ùˆ Ù†ÛŒÙˆ"),
    ("12â…œ", "Ø¯ÙˆØ§Ø²Ø¯Û• Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•ÙˆØ§Ùˆ Ùˆ Ø³Û Ù„Û•Ø³Û•Ø± Ú¾Û•Ø´Øª"), # Standard Heh
    # Math Expressions
    ("5 + 3 - 2 * 4 / 2 = 10", "Ù¾ÛÙ†Ø¬ Ú©Û† Ø³Û Ú©Û•Ù… Ø¯ÙˆÙˆ Ú©Û•Ú•Û•ØªÛŒ Ú†ÙˆØ§Ø± Ø¯Ø§Ø¨Û•Ø´ Ø¯ÙˆÙˆ ÛŒÛ•Ú©Ø³Ø§Ù†Û• Ø¨Û• Ø¯Û•"),
    ("ln 4 / log 10 + sin 90", "Ù„Û†Ú¯Ø§Ø±ÛŒØªÙ…ÛŒ Ø³Ø±ÙˆØ´ØªÛŒ Ú†ÙˆØ§Ø± Ø¯Ø§Ø¨Û•Ø´ Ù„Û†Ú¯Ø§Ø±ÛŒØªÙ…ÛŒ Ø¯Û• Ú©Û† Ø³Ø§ÛŒÙ†ÛŒ Ù†Û•ÙˆÛ•Ø¯"),
    ("val â‰ˆ 3.14", "Ú¤Ø§Ù„ Ù†Ø²ÛŒÚ©Û•ÛŒ Ø³Û Ù¾Û†ÛŒÙ†Øª Ú†ÙˆØ§Ø±Ø¯Û•"), # Corrected: Phonetic "val"
    ("Area = 50m^2", "Ø¦ÛÚ•ÛŒÛ• ÛŒÛ•Ú©Ø³Ø§Ù†Û• Ø¨Û• Ù¾Û•Ù†Ø¬Ø§ Ù…Û•ØªØ± ØªÙˆØ§Ù† Ø¯ÙˆÙˆ"), # Corrected: Phonetic "Area"
    ("speed = 4 + 6", "Ø³Ù¾ÛŒØ¯ ÛŒÛ•Ú©Ø³Ø§Ù†Û• Ø¨Û• Ú†ÙˆØ§Ø± Ú©Û† Ø´Û•Ø´"), # Corrected: Phonetic "speed"
    ("(10 + 5) * [2 - 1]", "Ø¯Û• Ú©Û† Ù¾ÛÙ†Ø¬ Ú©Û•Ú•Û•ØªÛŒ Ø¯ÙˆÙˆ Ú©Û•Ù… ÛŒÛ•Ú©"),
    # Variables & Unary Ops
    ("x + 1", "Ø¦ÛÚ©Ø³ Ú©Û† ÛŒÛ•Ú©"),
    ("-x", "Ø³Ø§Ù„Ø¨ Ø¦ÛÚ©Ø³"),
    ("2a", "Ø¯ÙˆÙˆ Ø¦Û•ÛŒ"), # Corrected: "a" -> "ay"
    ("(-x Â± âˆš(bÂ² âˆ’ 4ac)) Ã· 2a", "Ø³Ø§Ù„Ø¨ Ø¦ÛÚ©Ø³ Ú©Û•Ù… Ú©Û† Ú•Û•Ú¯ÛŒ Ø¯ÙˆÙˆØ¬Ø§ÛŒ Ø¨ÛŒ ØªÙˆØ§Ù† Ø¯ÙˆÙˆ Ú©Û•Ù… Ú†ÙˆØ§Ø± Ø¦Û•ÛŒ Ø³ÛŒ Ø¯Ø§Ø¨Û•Ø´ Ø¯ÙˆÙˆ Ø¦Û•ÛŒ"), # Corrected: "2a" -> "duu ay"
    # Subscripts & Superscripts
    ("xÂ³", "Ø¦ÛÚ©Ø³ ØªÙˆØ§Ù† Ø³Û"),
    ("2Â³", "Ø¯ÙˆÙˆ ØªÙˆØ§Ù† Ø³Û"),
    ("logâ‚â‚€", "Ù„Û†Ú¯Ø§Ø±ÛŒØªÙ…ÛŒ Ø¨Ù†Ú†ÛŒÙ†Û• Ø¯Û•"),
])
def test_numbers_and_math(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 2. Units & Measurements ---
@pytest.mark.parametrize("input_text, expected", [
    # Ambiguity Checks
    ("10m", "Ø¯Û• Ù…Û•ØªØ±"),
    ("I am m", "Ø¦Ø§ÛŒ Ø¦Ø§Ù… Ø¦ÛÙ…"),
    ("5mm", "Ù¾ÛÙ†Ø¬ Ù…ÛŒÙ„ÛŒÙ…Û•ØªØ±"),
    ("5mm gun", "Ù¾ÛÙ†Ø¬ Ù…ÛŒÙ„ÛŒÙ…Û•ØªØ± Ú¯Û•Ù†"),
    # Half Rule Logic
    ("4.5 Ù…Ø±ÛŒØ´Ú©", "Ú†ÙˆØ§Ø± Ù…Ø±ÛŒØ´Ú© Ùˆ Ù†ÛŒÙˆ"),
    ("1.5 Ù…Ø±ÛŒØ´Ú©Û•Ú©Ø§Ù†Ù…", "ÛŒÛ•Ú© Ù…Ø±ÛŒØ´Ú© Ùˆ Ù†ÛŒÙˆÛ•Ú©Ø§Ù†Ù…"),
    ("2.5 Ø²Û†Ø±Ø¨ÙˆÙˆÙ†", "Ø¯ÙˆÙˆ Ùˆ Ù†ÛŒÙˆ Ø²Û†Ø±Ø¨ÙˆÙˆÙ†"),
    # Per Rule
    ("120km/h", "Ø³Û•Ø¯ Ùˆ Ø¨ÛŒØ³Øª Ú©ÛŒÙ„Û†Ù…Û•ØªØ± Ø¨Û† Ú¾Û•Ø± Ú©Ø§ØªÚ˜Ù…ÛØ±ÛÚ©"),
    ("10km/hÙ€Û•", "Ø¯Û• Ú©ÛŒÙ„Û†Ù…Û•ØªØ± Ø¨Û† Ú¾Û•Ø± Ú©Ø§ØªÚ˜Ù…ÛØ±ÛÚ©Û•"),
    # Complex Units
    ("3.5mg/ml", "Ø³Û Ù…ÛŒÙ„ÛŒÚ¯Ø±Ø§Ù… Ùˆ Ù†ÛŒÙˆ Ø¨Û† Ú¾Û•Ø± Ù…ÛŒÙ„ÛŒÙ„ÛŒØªØ±ÛÚ©"), # Corrected: Per Rule logic
    ("500gb hard drive", "Ù¾ÛÙ†Ø¬ Ø³Û•Ø¯ Ú¯ÛÚ¯Ø§Ø¨Ø§ÛŒØª Ú¾Ø§Ú•Ø¯ Ø¯Ú•Ø§ÛŒÚ¤"),
    ("2.0 m", "Ø¯ÙˆÙˆ Ù¾Û†ÛŒÙ†Øª Ø³ÙØ± Ù…Û•ØªØ±"), # Assuming .0 strip fix works
    ("mÂ³", "Ù…Û•ØªØ±ÛŒ Ø³ÛØ¬Ø§"),
    ("2mÂ³", "Ø¯ÙˆÙˆ Ù…Û•ØªØ±ÛŒ Ø³ÛØ¬Ø§"),
])
def test_units(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 3. Currency ---
@pytest.mark.parametrize("input_text, expected", [
    ("25000 IQD", "Ø¨ÛŒØ³Øª Ùˆ Ù¾ÛÙ†Ø¬ Ú¾Û•Ø²Ø§Ø± Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛÚ•Ø§Ù‚ÛŒ"), # Corrected: IQD -> Dinar
    ("$12.50", "Ø¯ÙˆØ§Ø²Ø¯Û• Ø¯Û†Ù„Ø§Ø± Ùˆ Ù¾Û•Ù†Ø¬Ø§ Ø³Û•Ù†Øª"),
    ("Â£50", "Ù¾Û•Ù†Ø¬Ø§ Ù¾Ø§ÙˆÛ•Ù†Ø¯"),
    ("â‚¬100", "Ø³Û•Ø¯ ÛŒÛ†Ø±Û†"),
    ("Â¥1000", "Ú¾Û•Ø²Ø§Ø± ÛŒÛ•Ù†"),
    ("$ vs Ø¯.Ø¹", "Ø¯Û†Ù„Ø§Ø± Ú¤Û•Ú•Ø³Û•Ø² Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛÚ•Ø§Ù‚ÛŒ"),
    ("15000 Ø¯.Ø¹", "Ù¾Ø§Ø²Ø¯Û• Ú¾Û•Ø²Ø§Ø± Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛÚ•Ø§Ù‚ÛŒ"),
    ("IQD: 25000 IQD", "Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛÚ•Ø§Ù‚ÛŒ : Ø¨ÛŒØ³Øª Ùˆ Ù¾ÛÙ†Ø¬ Ú¾Û•Ø²Ø§Ø± Ø¯ÛŒÙ†Ø§Ø±ÛŒ Ø¹ÛÚ•Ø§Ù‚ÛŒ"), # Corrected: IQD -> Dinar
])
def test_currency(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 4. Phone & Date ---
@pytest.mark.parametrize("input_text, expected", [
    ("07501234567", "Ø³ÙØ± Ø­Û•ÙˆØª Ø³Û•Ø¯ Ùˆ Ù¾Û•Ù†Ø¬Ø§ Ø³Û•Ø¯ Ùˆ Ø¨ÛŒØ³Øª Ùˆ Ø³Û Ú†Ù„ Ùˆ Ù¾ÛÙ†Ø¬ Ø´Û•Ø³Øª Ùˆ Ø­Û•ÙˆØª"),
    ("+9647701234567", "Ú©Û† Ù†Û† Ø³Û•Ø¯ Ùˆ Ø´Û•Ø³Øª Ùˆ Ú†ÙˆØ§Ø± Ø­Û•ÙˆØª Ø³Û•Ø¯ Ùˆ Ø­Û•ÙØªØ§ Ø³Û•Ø¯ Ùˆ Ø¨ÛŒØ³Øª Ùˆ Ø³Û Ú†Ù„ Ùˆ Ù¾ÛÙ†Ø¬ Ø´Û•Ø³Øª Ùˆ Ø­Û•ÙˆØª"),
    ("2025/12/03", "Ø³ÛÛŒ Ú©Ø§Ù†ÙˆÙ†ÛŒ ÛŒÛ•Ú©Û•Ù…ÛŒ Ø³Ø§ÚµÛŒ Ø¯ÙˆÙˆ Ú¾Û•Ø²Ø§Ø± Ùˆ Ø¨ÛŒØ³Øª Ùˆ Ù¾ÛÙ†Ø¬"),
    ("12:30 PM", "Ø¯ÙˆØ§Ø²Ø¯Û• Ùˆ Ù†ÛŒÙˆÛŒ Ù†ÛŒÙˆÛ•Ú•Û†"),
    ("12:30 PMÙ€Û•", "Ø¯ÙˆØ§Ø²Ø¯Û• Ùˆ Ù†ÛŒÙˆÛŒ Ù†ÛŒÙˆÛ•Ú•Û†ÛŒÛ•"),
    ("06:41ÛŒ Ø¨Û•ÛŒØ§Ù†ÛŒ", "Ø´Û•Ø´ Ùˆ Ú†Ù„ Ùˆ ÛŒÛ•Ú© Ø®ÙˆÙ„Û•Ú©ÛŒ Ø¨Û•ÛŒØ§Ù†ÛŒ"),
])
def test_phone_date(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 5. Global Scripts & Transliteration ---
@pytest.mark.parametrize("input_text, expected", [
    ("Hello World", "Ú¾ÛÙ„Û† ÙˆÛ•Ú•Ù„Ø¯"),
    ("ChatGPT", "Ú†Ø§Øª Ø¬ÛŒ Ù¾ÛŒ ØªÛŒ"),
    ("Straáºe", "Ø³ØªÚ•Ø§Ø³Ø³Û"),
    ("RÃ©publique franÃ§aise", "Ú•ÛÙ¾ÙˆØ¨Ù„ÛŒÚ©ÙˆÛ ÙÚ•Ø§Ù†Ø³Ø§ÛŒØ³Û"),
    ("Î§Î±Î¯ÏÎµÏ„Îµ", "Ú†Ø§ÛŒÚ•ÛØªÛ"),
    ("ĞŸÑƒÑ‚Ğ¸Ğ½", "Ù¾ÙˆØªÛŒÙ†"),
    ("åŒ—äº¬å¸‚", "Ø¨ÛÛŒ Ø¬ÛŒÙ†Ú¯ Ø´ÛŒ"),
    ("ÃŠvar baÅŸ", "Ø¦ÛÚ¤Ø§Ú• Ø¨Ø§Ø´"),
    ("UKÙ…", "ÛŒÙˆ Ú©Û•ÛŒÙ…"),
    ("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚Ù€ÛŒØ´Ù…Ø§Ù†", "Ù¾Ú•ÛŒÚ¤ÛŒÛØªÛŒØ´Ù…Ø§Ù†"),
])
def test_global_scripts(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 6. Tajweed & Diacritics ---
@pytest.mark.parametrize("input_text, expected", [
    ("Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù", "Ø¨ÛŒØ³Ù…ÛŒ Ù„Ù„Ø§Ú¾ÛŒ Ú•Ú•Û•Ø­Ù…Ø§Ù†ÛŒ Ú•Ú•Û•Ø­ÛŒÙ…ÛŒ"),
    ("Ù±Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù", "Ø¦Û•Ù„Ø­Û•Ù…Ø¯Ùˆ Ù„ÛŒÙ„Ù„Ø§Ú¾ÛŒ"),
    ("Ø¹ÙØ¨Ø¯ÙØ§Ù„Ù„Ù‘Ù°Ù‡", "Ø¹Û•Ø¨Ø¯ÙˆÚµÚµØ§Ú¾"),
    ("Ù…ÙØ±Ù’ØµÙØ§Ø¯", "Ù…ÛŒÚ•ØµØ§Ø¯"),
    ("Ù…ÙÙ†Ù’ Ø¨ÙØ¹Ù’Ø¯", "Ù…ÛŒÙ† Ø¨Û•Ø¹Ø¯"),
    ("Ù…ÙÙ†Ù’ ÙŠÙÙ‚ÙÙˆÙ„", "Ù…Û•Ù† ÛŒÛ•Ù‚ÙˆÙ„"),
    ("Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯", "Ù…ÙˆØ­Û•Ù…Ù…Û•Ø¯"),
    ("Ø®ÙÙ„ÙÙˆÙ’Ø§ÛŸ", "Ø®Û•Ù„Û•Ùˆ"),
])
def test_diacritics(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 7. Technical & Web ---
@pytest.mark.parametrize("input_text, expected", [
    ("info@gmail.com", "Ø¦ÛŒÙ†ÙÛ† Ø¦Û•Øª Ø¬ÛŒÙ…Û•ÛŒÚµ Ø¯Û†Øª Ú©Û†Ù…"),
    ("xwshm@ÃªxamplÃ©.com", "Ø¦ÛÚ©Ø³ Ø¯Û•Ø¨ÚµÛŒÙˆ Ø¦ÛØ³ Ø¦ÛÚ† Ø¦ÛÙ… Ø¦Û•Øª Ø¦ÛŒ Ø¦ÛÚ©Ø³ Ø¦Û•ÛŒ Ø¦ÛÙ… Ù¾ÛŒ Ø¦ÛÚµ Ø¦ÛŒ Ø¯Û†Øª Ú©Û†Ù…"),
    ("https://www.rudaw.net/sorani?id=123", "Ø¦ÛÚ† ØªÛŒ ØªÛŒ Ù¾ÛŒ Ø¦ÛØ³ Ø¯ÙˆÙˆ Ø®Ø§Úµ Ø³Ù„Ø§Ø´ Ø³Ù„Ø§Ø´ Ø¯Û•Ø¨ÚµÛŒÙˆ Ø¯Û•Ø¨ÚµÛŒÙˆ Ø¯Û•Ø¨ÚµÛŒÙˆ Ø¯Û†Øª Ø¦Ø§Ú• ÛŒÙˆ Ø¯ÛŒ Ø¦Û•ÛŒ Ø¯Û•Ø¨ÚµÛŒÙˆ Ø¯Û†Øª Ù†ÛØª Ø³Ù„Ø§Ø´ Ø¦ÛØ³ Ø¦Û† Ø¦Ø§Ú• Ø¦Û•ÛŒ Ø¦ÛÙ† Ø¦Ø§ÛŒ Ù†ÛŒØ´Ø§Ù†Û•ÛŒ Ù¾Ø±Ø³ÛŒØ§Ø± Ø¦Ø§ÛŒ Ø¯ÛŒ ÛŒÛ•Ú©Ø³Ø§Ù†Û• ÛŒÛ•Ú© Ø¯ÙˆÙˆ Ø³Û"),
    ("123e4567-e89b-12d3", "ÛŒÛ•Ú© Ø¯ÙˆÙˆ Ø³Û Ø¦ÛŒ Ú†ÙˆØ§Ø± Ù¾ÛÙ†Ø¬ Ø´Û•Ø´ Ø­Û•ÙˆØª Ø¯Ø§Ø´ Ø¦ÛŒ Ú¾Û•Ø´Øª Ù†Û† Ø¨ÛŒ Ø¯Ø§Ø´ ÛŒÛ•Ú© Ø¯ÙˆÙˆ Ø¯ÛŒ Ø³Û"),
    ("00:1A:2B:3C:4D:5E", "Ø³ÙØ± Ø³ÙØ± Ø¯ÙˆÙˆ Ø®Ø§Úµ ÛŒÛ•Ú© Ø¦Û•ÛŒ Ø¯ÙˆÙˆ Ø®Ø§Úµ Ø¯ÙˆÙˆ Ø¨ÛŒ Ø¯ÙˆÙˆ Ø®Ø§Úµ Ø³Û Ø³ÛŒ Ø¯ÙˆÙˆ Ø®Ø§Úµ Ú†ÙˆØ§Ø± Ø¯ÛŒ Ø¯ÙˆÙˆ Ø®Ø§Úµ Ù¾ÛÙ†Ø¬ Ø¦ÛŒ"), # MAC Address
    ("8-Î±Î²Î³123", "Ú¾Û•Ø´Øª Ø¯Ø§Ø´ Ø¦Ø§ÚµÙØ§ Ø¨ÛØªØ§ Ú¯Ø§Ù…Ø§ ÛŒÛ•Ú© Ø¯ÙˆÙˆ Ø³Û"),
    ("-Î±Î²Î³123", "Ø¯Ø§Ø´ Ø¦Ø§ÚµÙØ§ Ø¨ÛØªØ§ Ú¯Ø§Ù…Ø§ ÛŒÛ•Ú© Ø¯ÙˆÙˆ Ø³Û"),
    ("#Kurdistan", "Ú¾Ø§Ø´ØªØ§Ú¯ Ú©Û•ÛŒ ÛŒÙˆ Ø¦Ø§Ú• Ø¯ÛŒ Ø¦Ø§ÛŒ Ø¦ÛØ³ ØªÛŒ Ø¦Û•ÛŒ Ø¦ÛÙ†"),
])
def test_technical(pipe, input_text, expected):
    assert pipe.normalize(input_text) == expected

# --- 8. Special Configurations ---
def test_emoji_convert():
    config = NormalizationConfig(emoji_mode="convert")
    pipe = Pipeline(config)
    assert pipe.normalize("Ø³ÚµØ§Ùˆ ğŸ˜‚ Ø¯ÚµÙ… â¤ï¸") == "Ø³ÚµØ§Ùˆ Ø¦ÛŒÙ…Û†Ø¬ÛŒÛŒÛ•Ú©ÛŒ Ù¾ÛÚ©Û•Ù†ÛŒÙ† Ùˆ ÙØ±Ù…ÛØ³Ú© Ø¯ÚµÙ… Ø¦ÛŒÙ…Û†Ø¬ÛŒÛŒÛ•Ú©ÛŒ Ø¯ÚµÛŒ Ø³ÙˆÙˆØ±"

def test_emoji_remove():
    config = NormalizationConfig(emoji_mode="remove")
    pipe = Pipeline(config)
    assert pipe.normalize("Ø³ÚµØ§Ùˆ ğŸ˜‚ Ø¯ÚµÙ… â¤ï¸") == "Ø³ÚµØ§Ùˆ Ø¯ÚµÙ…"

def test_pause_markers():
    config = NormalizationConfig(enable_pause_markers=True, pause_token="|")
    pipe = Pipeline(config)
    # Note: PhoneNormalizer puts pause between groups. SymbolNormalizer allows |.
    expected = "Ø³ÙØ± Ø­Û•ÙˆØª Ø³Û•Ø¯ Ùˆ Ù¾Û•Ù†Ø¬Ø§ | Ø³Û•Ø¯ Ùˆ Ø¨ÛŒØ³Øª Ùˆ Ø³Û | Ú†Ù„ Ùˆ Ù¾ÛÙ†Ø¬ | Ø´Û•Ø³Øª Ùˆ Ø­Û•ÙˆØª"
    assert pipe.normalize("07501234567") == expected

def test_percentages_half_rule_exception():
    # Percentage should DISABLE the "move niw to end" half rule
    pipe = Pipeline()
    assert pipe.normalize("2.5%") == "Ù„Û•Ø³Û•Ø¯Ø§ Ø¯ÙˆÙˆ Ùˆ Ù†ÛŒÙˆ"
    assert pipe.normalize("Ùª2.5") == "Ù„Û•Ø³Û•Ø¯Ø§ Ø¯ÙˆÙˆ Ùˆ Ù†ÛŒÙˆ"
    assert pipe.normalize("2.5% Ø¨Ø²Ù†") == "Ù„Û•Ø³Û•Ø¯Ø§ Ø¯ÙˆÙˆ Ùˆ Ù†ÛŒÙˆ Ø¨Ø²Ù†"